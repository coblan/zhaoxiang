{% extends "jb_admin/table.html" %}
{% load static %}
{% load jsonify %}

{% block extra_head %}
<script src='{% static "js/geoscope.pack.js" %}?t={{ js_stamp.geoscope_pack_js }}'></script>
<script type="text/javascript">

    ex.each(heads,function(head){
        if(head.name=='block'){
            head.type='com-weilan'
        }
    })
    this_logic={
        watch:{
            'row_sort.sort_str':function (v) {
                this.search_args._sort=v
                this.search()
            }
        },
        mounted:function(){
            var map_com = this.$refs.map_com
            map_com.on_init(function(){
                ex.each(rows,function(row){
                    row.js_poly = map_com.insert_polygon(row.polygon)
                })
                map_com.map.setFitView();
            })
        },
        methods:{
            hight_region:function(row){
                var map_com = this.$refs.map_com
                if(this._old_row && this._old_row.js_poly){
                    map_com.remove_highlight_polygon(this._old_row.js_poly)
                }
                this._old_row=row
                map_com.highlight_polygon(row.js_poly,'white')
            },
            map:function(row,name){
                return row[name]
            }
        }

    }
    table_logic.mixins = [mix_table_data,this_logic]
</script>

<script>
    Vue.component('com-weilan',{
        props:['name','row'],
        template:'<a href="#" @click="on_click()" v-text="row[name]"></a>',
        methods:{
            on_click:function(){
                this.$root.hight_region(this.row)
            }
        }
    })
</script>
{% endblock %}

{% block table-content %}
<div class="flex flex-grow">
    <div style="margin: 1em 2em;min-width: 30em;">
        <com-table class='table fake-suit' :has_check="!search_args._pop" :map="map"
                   :row_sort="row_sort" :heads="heads" :rows="rows" v-model="selected"></com-table>

        <paginator :nums='row_pages.options' :crt='row_pages.crt_page' @goto_page='goto_page($event)'></paginator>
    </div>
    <div class="flex-grow" style="position: relative;">
        <com-map ref="map_com"></com-map>
    </div>
</div>
{% endblock %}



<!--<div id='there' style="height: 100%;" class="flex-v">-->

    <!--&lt;!&ndash;<ol v-if="page_label" class="breadcrumb">&ndash;&gt;-->
        <!--&lt;!&ndash;<b v-text="page_label"></b>&ndash;&gt;-->
    <!--&lt;!&ndash;</ol>&ndash;&gt;-->
    <!--&lt;!&ndash;<path-nav v-else :menu='menu'></path-nav>&ndash;&gt;-->

    <!--<div class='btn-panel flex flex-sb' style="padding-left:20px; ">-->

        <!--&lt;!&ndash;<div v-if="row_filters.length==0" class="flex-grow"></div>&ndash;&gt;-->
        <!--<com-filter class="flex" :heads="row_filters" :search="search_args"-->
                    <!--:search_tip='search_tip' @submit="search()"></com-filter>-->
        <!--<div class="flex-grow"></div>-->

        <!--<com-table-btn v-if="!search_args._pop" :add_new="add_new" :del_item="del_item" :table_bus="this">-->
            <!--{% block extra_btn %}-->
            <!--{% endblock %}-->
        <!--</com-table-btn>-->

        <!--&lt;!&ndash;<div class='btn-group' style='float: right;' v-if="!search_args._pop">&ndash;&gt;-->
        <!--&lt;!&ndash;<a type="button" class="btn btn-success btn-sm" :href='add_new()' v-if='can_add' role="button">创建</a>&ndash;&gt;-->
        <!--&lt;!&ndash;<button type="button" class="btn btn-danger btn-sm" @click='del_item()' v-if='can_del'>删除</button>&ndash;&gt;-->
        <!--&lt;!&ndash;</div>&ndash;&gt;-->

    <!--</div>-->

    <!--<div class="flex flex-grow">-->
        <!--<div style="margin: 1em 2em;min-width: 30em;">-->
            <!--<com-table class='table fake-suit' :has_check="!search_args._pop" :map="map"-->
                       <!--:row_sort="row_sort" :heads="heads" :rows="rows" v-model="selected"></com-table>-->

            <!--<paginator :nums='row_pages.options' :crt='row_pages.crt_page' @goto_page='goto_page($event)'></paginator>-->
        <!--</div>-->
        <!--<div class="flex-grow" style="position: relative;">-->
            <!--<com-map ref="map_com"></com-map>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->
